# APX Validation & Hardening Task Tracker
# Tracks validation sprint tasks from VALIDATION_HARDENING_PLAN.md

version: "1.0"
last_updated: "2025-11-11T00:00:00Z"
project: "APX - Validation & Hardening Sprint"

# Overall Progress
progress:
  phase_1:
    name: "Immediate Verification (72 Hours)"
    status: IN_PROGRESS
    completion: 0%
    tasks_total: 6
    tasks_complete: 0
    tasks_in_progress: 0
    tasks_blocked: 1

# Validation Tasks
tasks:
  # ============================================================================
  # PHASE 1: Immediate Verification (72 Hours)
  # ============================================================================

  V-001:
    name: "Smoke Check - Request Pathing"
    phase: "Phase 1: Immediate Verification"
    priority: "P0"
    status: "NOT_STARTED"
    assigned_to: "backend-agent-1"
    dependencies: []
    estimated_hours: 2
    started_at: null
    completed_at: null
    artifacts:
      expected:
        - "tests/smoke/request_pathing_test.sh"
      actual: []
    notes: []
    acceptance_criteria:
      - checked: false
        text: "Request returns 202 Accepted"
      - checked: false
        text: "Request ID generated and returned"
      - checked: false
        text: "Message published to Pub/Sub"
      - checked: false
        text: "Worker receives and processes message"
      - checked: false
        text: "Status endpoint returns result"
      - checked: false
        text: "End-to-end latency < 5 seconds (dev environment)"

  V-002:
    name: "Header Propagation Verification"
    phase: "Phase 1: Immediate Verification"
    priority: "P0"
    status: "BLOCKED"
    assigned_to: null
    dependencies: ["V-001"]
    estimated_hours: 1.5
    started_at: null
    completed_at: null
    blocking_reason: "Task V-001 (Smoke Check - Request Pathing) has not been completed. V-001 must be COMPLETE before V-002 can begin."
    blocking_details:
      - "V-001 status: NOT_STARTED"
      - "Required artifact missing: tests/smoke/request_pathing_test.sh"
      - "No evidence of dev environment deployment"
      - "No evidence of end-to-end request flow verification"
    artifacts:
      expected:
        - "tests/smoke/header_propagation_test.sh"
      actual: []
    notes:
      - "2025-11-11: Checked for V-001 completion. Found no smoke test directory, no request_pathing_test.sh script, and no VALIDATION_TRACKER.yaml indicating V-001 was done."
      - "2025-11-11: Marked V-002 as BLOCKED until V-001 is completed."
    acceptance_criteria:
      - checked: false
        text: "Request ID preserved if provided, generated if not"
      - checked: false
        text: "Tenant ID extracted and propagated"
      - checked: false
        text: "Policy version tagged on every request"
      - checked: false
        text: "Region tagged based on deployment"
      - checked: false
        text: "All headers appear in traces"
      - checked: false
        text: "All headers appear in logs (where not redacted)"

  V-003:
    name: "Canary Rollout Test"
    phase: "Phase 1: Immediate Verification"
    priority: "P0"
    status: "NOT_STARTED"
    assigned_to: null
    dependencies: ["V-001"]
    estimated_hours: 3
    started_at: null
    completed_at: null
    artifacts:
      expected:
        - "tests/integration/canary_rollout_test.sh"
        - "tools/cli/apx rollout implementation"
        - "tools/cli/apx rollback implementation"
      actual: []
    notes: []
    acceptance_criteria:
      - checked: false
        text: "Canary traffic split accurate within ±2%"
      - checked: false
        text: "In-flight requests use admitted policy version"
      - checked: false
        text: "Workers support N and N-1 versions simultaneously"
      - checked: false
        text: "Breaking policy triggers auto-rollback"
      - checked: false
        text: "Rollback completes in < 2 minutes"
      - checked: false
        text: "Zero dropped requests during rollout"

  V-004:
    name: "Async Contract Verification"
    phase: "Phase 1: Immediate Verification"
    priority: "P0"
    status: "NOT_STARTED"
    assigned_to: null
    dependencies: ["V-001"]
    estimated_hours: 2
    started_at: null
    completed_at: null
    artifacts:
      expected:
        - "tests/integration/async_pattern_test.sh"
        - "workers/streaming_aggregator implementation"
      actual: []
    notes: []
    acceptance_criteria:
      - checked: false
        text: "202 response includes status_url"
      - checked: false
        text: "Status endpoint shows correct state transitions"
      - checked: false
        text: "SSE streaming works for long responses"
      - checked: false
        text: "Stream resume token works correctly"
      - checked: false
        text: "Clients can poll status every 1s without rate limiting"
      - checked: false
        text: "Status available for 24 hours after completion"

  V-005:
    name: "Cost Controls Verification"
    phase: "Phase 1: Immediate Verification"
    priority: "P0"
    status: "NOT_STARTED"
    assigned_to: null
    dependencies: ["V-001"]
    estimated_hours: 2
    started_at: null
    completed_at: null
    artifacts:
      expected:
        - "tests/integration/cost_controls_test.sh"
        - "observability/budgets/alert_rules.yaml"
      actual: []
    notes: []
    acceptance_criteria:
      - checked: false
        text: "Log sampling at 1% for success requests"
      - checked: false
        text: "100% of error logs captured"
      - checked: false
        text: "BigQuery partitioned by day, clustered correctly"
      - checked: false
        text: "Hourly aggregates materialized"
      - checked: false
        text: "Raw logs expire after 30 days"
      - checked: false
        text: "Budget alert fires at 70% threshold"
      - checked: false
        text: "Auto-sampling adjustment works"

  V-006:
    name: "Load Testing Baseline"
    phase: "Phase 1: Immediate Verification"
    priority: "P0"
    status: "NOT_STARTED"
    assigned_to: null
    dependencies: ["V-001", "V-002", "V-003", "V-004", "V-005"]
    estimated_hours: 4
    started_at: null
    completed_at: null
    artifacts:
      expected:
        - "tools/load-testing/baseline.js"
        - "tools/load-testing/analyze_results.sh"
        - "results/baseline-YYYY-MM-DD.json"
        - "docs/runbooks/load-testing.md"
      actual: []
    notes: []
    acceptance_criteria:
      - checked: false
        text: "Sustained 1k rps for 5 minutes"
      - checked: false
        text: "p95 latency < 100ms"
      - checked: false
        text: "p99 latency < 200ms"
      - checked: false
        text: "Error rate < 1%"
      - checked: false
        text: "Auto-scaling: 1 → 100 instances"
      - checked: false
        text: "No dropped requests during scale-up"
      - checked: false
        text: "BigQuery cost < $1 for test duration"

# Blockers (active blockers tracked here)
blockers:
  - task_id: "V-002"
    blocked_by: "V-001"
    reason: "V-001 (Smoke Check - Request Pathing) must be completed before V-002 can begin"
    detected_at: "2025-11-11T00:00:00Z"
    severity: "HIGH"
    impact: "Cannot verify header propagation without a working request flow"
    resolution_required:
      - "Complete V-001: Deploy minimal stack to dev environment"
      - "Complete V-001: Verify request path: edge → router → Pub/Sub → worker → stream"
      - "Complete V-001: Create tests/smoke/request_pathing_test.sh"
      - "Update VALIDATION_TRACKER.yaml to mark V-001 as COMPLETE"

# Daily Logs
daily_logs:
  - date: "2025-11-11"
    entries:
      - time: "00:00:00Z"
        task: "V-002"
        agent: "backend-agent-1"
        action: "Dependency check performed"
        details: "Verified V-001 status. Found V-001 NOT_STARTED. Marking V-002 as BLOCKED."
      - time: "00:00:00Z"
        task: "V-002"
        agent: "backend-agent-1"
        action: "Created VALIDATION_TRACKER.yaml"
        details: "Initialized validation tracking system for APX Validation & Hardening Plan."

# Metrics
metrics:
  validation_tasks_total: 6
  validation_tasks_complete: 0
  validation_tasks_in_progress: 0
  validation_tasks_blocked: 1
  validation_tasks_not_started: 5
  blockers_active: 1
  blockers_resolved: 0
